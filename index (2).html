<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WirePro">
    <meta name="theme-color" content="#0a0a0a">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a0a' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='%23f59e0b'>⚡</text></svg>">
    <link rel="manifest" href="manifest.json">
    <title>WirePro - Motorsports Wiring Diagrams</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --bg-elevated: #222222;
            --border-subtle: #2a2a2a;
            --border-strong: #3a3a3a;
            --text-primary: #f5f5f5;
            --text-secondary: #a0a0a0;
            --text-muted: #666666;
            --accent-amber: #f59e0b;
            --accent-amber-dim: #b45309;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
            --accent-cyan: #06b6d4;
            --wire-power: #ef4444;
            --wire-ground: #000000;
            --wire-signal: #3b82f6;
            --wire-can-h: #22c55e;
            --wire-can-l: #a855f7;
            --wire-data: #06b6d4;
        }

        html, body, #root {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border-strong);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px var(--accent-amber); }
            50% { box-shadow: 0 0 20px var(--accent-amber), 0 0 30px var(--accent-amber-dim); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // Wire colors available
        const WIRE_COLORS = [
            { id: 'red', name: 'Red', hex: '#ef4444' },
            { id: 'black', name: 'Black', hex: '#1a1a1a' },
            { id: 'white', name: 'White', hex: '#f5f5f5' },
            { id: 'green', name: 'Green', hex: '#22c55e' },
            { id: 'blue', name: 'Blue', hex: '#3b82f6' },
            { id: 'yellow', name: 'Yellow', hex: '#eab308' },
            { id: 'orange', name: 'Orange', hex: '#f97316' },
            { id: 'purple', name: 'Purple', hex: '#a855f7' },
            { id: 'pink', name: 'Pink', hex: '#ec4899' },
            { id: 'brown', name: 'Brown', hex: '#92400e' },
            { id: 'gray', name: 'Gray', hex: '#6b7280' },
            { id: 'tan', name: 'Tan', hex: '#d4a574' },
            { id: 'lt-green', name: 'Lt Green', hex: '#86efac' },
            { id: 'lt-blue', name: 'Lt Blue', hex: '#93c5fd' },
            { id: 'dk-green', name: 'Dk Green', hex: '#166534' },
            { id: 'dk-blue', name: 'Dk Blue', hex: '#1e40af' },
        ];

        const WIRE_GAUGES = ['22 AWG', '20 AWG', '18 AWG', '16 AWG', '14 AWG', '12 AWG', '10 AWG', '8 AWG'];
        
        const CONNECTOR_TYPES = [
            'Deutsch DT', 'Deutsch DTM', 'Deutsch DTP',
            'Metri-Pack 150', 'Metri-Pack 280', 'Metri-Pack 480',
            'Weather Pack', 'AMP Superseal', 'Molex MX150',
            'TE MCP', 'Sumitomo HW', 'Sumitomo MT',
            'Ring Terminal', 'Spade Terminal', 'Butt Splice',
            'OEM', 'Custom'
        ];

        const PIN_TYPES = [
            { id: 'power', name: 'Power (+)', color: '#ef4444' },
            { id: 'ground', name: 'Ground (-)', color: '#1a1a1a' },
            { id: 'signal', name: 'Signal', color: '#3b82f6' },
            { id: 'can-h', name: 'CAN High', color: '#22c55e' },
            { id: 'can-l', name: 'CAN Low', color: '#a855f7' },
            { id: 'data', name: 'Data', color: '#06b6d4' },
            { id: 'input', name: 'Input', color: '#f97316' },
            { id: 'output', name: 'Output', color: '#eab308' },
            { id: 'nc', name: 'Not Connected', color: '#6b7280' },
        ];

        // Default parts library
        const DEFAULT_PARTS = [
            {
                id: 'ecu-generic',
                name: 'ECU',
                category: 'ECU',
                width: 180,
                height: 120,
                pins: [
                    { id: 'p1', label: 'IGN', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'GND', type: 'ground', position: 'left', index: 1 },
                    { id: 'p3', label: 'CAN-H', type: 'can-h', position: 'left', index: 2 },
                    { id: 'p4', label: 'CAN-L', type: 'can-l', position: 'left', index: 3 },
                    { id: 'p5', label: 'INJ1', type: 'output', position: 'right', index: 0 },
                    { id: 'p6', label: 'INJ2', type: 'output', position: 'right', index: 1 },
                    { id: 'p7', label: 'INJ3', type: 'output', position: 'right', index: 2 },
                    { id: 'p8', label: 'INJ4', type: 'output', position: 'right', index: 3 },
                ]
            },
            {
                id: 'relay-4pin',
                name: '4-Pin Relay',
                category: 'Relay',
                width: 100,
                height: 80,
                pins: [
                    { id: 'p1', label: '85', type: 'signal', position: 'left', index: 0 },
                    { id: 'p2', label: '86', type: 'ground', position: 'left', index: 1 },
                    { id: 'p3', label: '30', type: 'power', position: 'right', index: 0 },
                    { id: 'p4', label: '87', type: 'output', position: 'right', index: 1 },
                ]
            },
            {
                id: 'relay-5pin',
                name: '5-Pin Relay',
                category: 'Relay',
                width: 100,
                height: 100,
                pins: [
                    { id: 'p1', label: '85', type: 'signal', position: 'left', index: 0 },
                    { id: 'p2', label: '86', type: 'ground', position: 'left', index: 1 },
                    { id: 'p3', label: '30', type: 'power', position: 'right', index: 0 },
                    { id: 'p4', label: '87', type: 'output', position: 'right', index: 1 },
                    { id: 'p5', label: '87a', type: 'output', position: 'right', index: 2 },
                ]
            },
            {
                id: 'fuse-single',
                name: 'Fuse',
                category: 'Fuse',
                width: 60,
                height: 50,
                pins: [
                    { id: 'p1', label: 'IN', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'OUT', type: 'power', position: 'right', index: 0 },
                ]
            },
            {
                id: 'fuse-box-4',
                name: '4-Way Fuse Box',
                category: 'Fuse',
                width: 140,
                height: 80,
                pins: [
                    { id: 'p1', label: 'PWR', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'F1', type: 'output', position: 'right', index: 0 },
                    { id: 'p3', label: 'F2', type: 'output', position: 'right', index: 1 },
                    { id: 'p4', label: 'F3', type: 'output', position: 'right', index: 2 },
                    { id: 'p5', label: 'F4', type: 'output', position: 'right', index: 3 },
                ]
            },
            {
                id: 'switch-spst',
                name: 'SPST Switch',
                category: 'Switch',
                width: 80,
                height: 50,
                pins: [
                    { id: 'p1', label: 'IN', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'OUT', type: 'output', position: 'right', index: 0 },
                ]
            },
            {
                id: 'switch-spdt',
                name: 'SPDT Switch',
                category: 'Switch',
                width: 80,
                height: 70,
                pins: [
                    { id: 'p1', label: 'COM', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'NO', type: 'output', position: 'right', index: 0 },
                    { id: 'p3', label: 'NC', type: 'output', position: 'right', index: 1 },
                ]
            },
            {
                id: 'sensor-2wire',
                name: '2-Wire Sensor',
                category: 'Sensor',
                width: 100,
                height: 60,
                pins: [
                    { id: 'p1', label: 'SIG', type: 'signal', position: 'left', index: 0 },
                    { id: 'p2', label: 'GND', type: 'ground', position: 'left', index: 1 },
                ]
            },
            {
                id: 'sensor-3wire',
                name: '3-Wire Sensor',
                category: 'Sensor',
                width: 100,
                height: 80,
                pins: [
                    { id: 'p1', label: '+5V', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'SIG', type: 'signal', position: 'left', index: 1 },
                    { id: 'p3', label: 'GND', type: 'ground', position: 'left', index: 2 },
                ]
            },
            {
                id: 'connector-2pin',
                name: '2-Pin Connector',
                category: 'Connector',
                width: 70,
                height: 50,
                pins: [
                    { id: 'p1', label: '1', type: 'signal', position: 'left', index: 0 },
                    { id: 'p2', label: '2', type: 'signal', position: 'right', index: 0 },
                ]
            },
            {
                id: 'connector-4pin',
                name: '4-Pin Connector',
                category: 'Connector',
                width: 70,
                height: 80,
                pins: [
                    { id: 'p1', label: '1', type: 'signal', position: 'left', index: 0 },
                    { id: 'p2', label: '2', type: 'signal', position: 'left', index: 1 },
                    { id: 'p3', label: '3', type: 'signal', position: 'right', index: 0 },
                    { id: 'p4', label: '4', type: 'signal', position: 'right', index: 1 },
                ]
            },
            {
                id: 'ground-point',
                name: 'Ground Point',
                category: 'Power',
                width: 60,
                height: 50,
                pins: [
                    { id: 'p1', label: 'GND', type: 'ground', position: 'top', index: 0 },
                ]
            },
            {
                id: 'power-source',
                name: 'Power Source',
                category: 'Power',
                width: 80,
                height: 50,
                pins: [
                    { id: 'p1', label: '+12V', type: 'power', position: 'right', index: 0 },
                ]
            },
            {
                id: 'battery',
                name: 'Battery',
                category: 'Power',
                width: 100,
                height: 60,
                pins: [
                    { id: 'p1', label: '+', type: 'power', position: 'right', index: 0 },
                    { id: 'p2', label: '-', type: 'ground', position: 'left', index: 0 },
                ]
            },
            {
                id: 'ignition-coil',
                name: 'Ignition Coil',
                category: 'Ignition',
                width: 90,
                height: 70,
                pins: [
                    { id: 'p1', label: '+12V', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'TRIG', type: 'signal', position: 'left', index: 1 },
                    { id: 'p3', label: 'OUT', type: 'output', position: 'right', index: 0 },
                ]
            },
            {
                id: 'injector',
                name: 'Fuel Injector',
                category: 'Fuel',
                width: 90,
                height: 60,
                pins: [
                    { id: 'p1', label: '+12V', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'CTRL', type: 'signal', position: 'left', index: 1 },
                ]
            },
            {
                id: 'fuel-pump',
                name: 'Fuel Pump',
                category: 'Fuel',
                width: 100,
                height: 60,
                pins: [
                    { id: 'p1', label: '+12V', type: 'power', position: 'left', index: 0 },
                    { id: 'p2', label: 'GND', type: 'ground', position: 'left', index: 1 },
                ]
            },
        ];

        // Generate unique ID
        const generateId = () => Math.random().toString(36).substr(2, 9);

        // Icon components
        const Icons = {
            Plus: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            ),
            Trash: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            ),
            Download: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            ),
            Upload: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
            ),
            Save: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
            ),
            FolderOpen: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
            ),
            Image: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
            ),
            Settings: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            ),
            Edit: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            ),
            X: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            ),
            Menu: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            ),
            Zap: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
            ),
            Copy: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            ),
            ZoomIn: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="11" y1="8" x2="11" y2="14"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            ),
            ZoomOut: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            ),
            Move: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="5 9 2 12 5 15"></polyline>
                    <polyline points="9 5 12 2 15 5"></polyline>
                    <polyline points="15 19 12 22 9 19"></polyline>
                    <polyline points="19 9 22 12 19 15"></polyline>
                    <line x1="2" y1="12" x2="22" y2="12"></line>
                    <line x1="12" y1="2" x2="12" y2="22"></line>
                </svg>
            ),
        };

        // Component styles
        const styles = {
            app: {
                display: 'flex',
                flexDirection: 'column',
                height: '100%',
                background: 'var(--bg-primary)',
            },
            header: {
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                padding: '12px 16px',
                background: 'var(--bg-secondary)',
                borderBottom: '1px solid var(--border-subtle)',
                zIndex: 100,
            },
            logo: {
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
            },
            logoIcon: {
                color: 'var(--accent-amber)',
            },
            logoText: {
                fontFamily: "'JetBrains Mono', monospace",
                fontSize: '18px',
                fontWeight: '700',
                letterSpacing: '-0.5px',
            },
            headerActions: {
                display: 'flex',
                gap: '8px',
            },
            iconButton: {
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                width: '40px',
                height: '40px',
                background: 'var(--bg-tertiary)',
                border: '1px solid var(--border-subtle)',
                borderRadius: '8px',
                color: 'var(--text-secondary)',
                cursor: 'pointer',
                transition: 'all 0.15s ease',
            },
            mainContent: {
                display: 'flex',
                flex: 1,
                overflow: 'hidden',
            },
            sidebar: {
                width: '280px',
                background: 'var(--bg-secondary)',
                borderRight: '1px solid var(--border-subtle)',
                display: 'flex',
                flexDirection: 'column',
                overflow: 'hidden',
            },
            sidebarHeader: {
                padding: '16px',
                borderBottom: '1px solid var(--border-subtle)',
            },
            sidebarTitle: {
                fontSize: '13px',
                fontWeight: '600',
                color: 'var(--text-secondary)',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
            },
            sidebarContent: {
                flex: 1,
                overflow: 'auto',
                padding: '12px',
            },
            canvas: {
                flex: 1,
                position: 'relative',
                overflow: 'hidden',
                background: 'var(--bg-primary)',
            },
            canvasInner: {
                position: 'absolute',
                transformOrigin: '0 0',
            },
            gridPattern: {
                position: 'absolute',
                top: 0,
                left: 0,
                width: '100%',
                height: '100%',
                backgroundImage: `
                    linear-gradient(var(--border-subtle) 1px, transparent 1px),
                    linear-gradient(90deg, var(--border-subtle) 1px, transparent 1px)
                `,
                backgroundSize: '20px 20px',
                opacity: 0.5,
            },
            partItem: {
                padding: '10px 12px',
                background: 'var(--bg-tertiary)',
                border: '1px solid var(--border-subtle)',
                borderRadius: '8px',
                marginBottom: '8px',
                cursor: 'grab',
                transition: 'all 0.15s ease',
            },
            partItemName: {
                fontSize: '14px',
                fontWeight: '500',
                color: 'var(--text-primary)',
            },
            partItemCategory: {
                fontSize: '11px',
                color: 'var(--text-muted)',
                marginTop: '2px',
            },
            categoryHeader: {
                fontSize: '11px',
                fontWeight: '600',
                color: 'var(--text-muted)',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
                padding: '8px 0 6px',
                marginTop: '8px',
            },
            component: {
                position: 'absolute',
                background: 'var(--bg-elevated)',
                border: '2px solid var(--border-strong)',
                borderRadius: '8px',
                cursor: 'move',
                userSelect: 'none',
                boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
            },
            componentSelected: {
                border: '2px solid var(--accent-amber)',
                boxShadow: '0 0 0 3px rgba(245, 158, 11, 0.2), 0 4px 12px rgba(0,0,0,0.3)',
            },
            componentHeader: {
                padding: '8px 10px',
                borderBottom: '1px solid var(--border-subtle)',
                fontSize: '12px',
                fontWeight: '600',
                fontFamily: "'JetBrains Mono', monospace",
                color: 'var(--text-primary)',
                textAlign: 'center',
                background: 'var(--bg-tertiary)',
                borderRadius: '6px 6px 0 0',
            },
            componentBody: {
                display: 'flex',
                justifyContent: 'space-between',
                padding: '8px 0',
                minHeight: '40px',
            },
            pinColumn: {
                display: 'flex',
                flexDirection: 'column',
                gap: '4px',
            },
            pin: {
                display: 'flex',
                alignItems: 'center',
                gap: '6px',
                padding: '4px 8px',
                fontSize: '11px',
                fontFamily: "'JetBrains Mono', monospace",
                cursor: 'pointer',
                transition: 'background 0.15s ease',
                borderRadius: '3px',
            },
            pinDot: {
                width: '10px',
                height: '10px',
                borderRadius: '50%',
                border: '2px solid var(--bg-primary)',
                flexShrink: 0,
            },
            pinLabel: {
                color: 'var(--text-secondary)',
                whiteSpace: 'nowrap',
            },
            modal: {
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0,0,0,0.8)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 1000,
                padding: '20px',
                animation: 'fadeIn 0.2s ease',
            },
            modalContent: {
                background: 'var(--bg-secondary)',
                borderRadius: '12px',
                width: '100%',
                maxWidth: '500px',
                maxHeight: '90vh',
                overflow: 'auto',
                border: '1px solid var(--border-subtle)',
                animation: 'slideUp 0.2s ease',
            },
            modalHeader: {
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                padding: '16px 20px',
                borderBottom: '1px solid var(--border-subtle)',
            },
            modalTitle: {
                fontSize: '18px',
                fontWeight: '600',
            },
            modalBody: {
                padding: '20px',
            },
            formGroup: {
                marginBottom: '16px',
            },
            label: {
                display: 'block',
                fontSize: '12px',
                fontWeight: '500',
                color: 'var(--text-secondary)',
                marginBottom: '6px',
            },
            input: {
                width: '100%',
                padding: '10px 12px',
                background: 'var(--bg-tertiary)',
                border: '1px solid var(--border-subtle)',
                borderRadius: '6px',
                color: 'var(--text-primary)',
                fontSize: '14px',
                outline: 'none',
                transition: 'border-color 0.15s ease',
            },
            select: {
                width: '100%',
                padding: '10px 12px',
                background: 'var(--bg-tertiary)',
                border: '1px solid var(--border-subtle)',
                borderRadius: '6px',
                color: 'var(--text-primary)',
                fontSize: '14px',
                outline: 'none',
                cursor: 'pointer',
            },
            button: {
                display: 'inline-flex',
                alignItems: 'center',
                justifyContent: 'center',
                gap: '8px',
                padding: '10px 16px',
                background: 'var(--accent-amber)',
                border: 'none',
                borderRadius: '6px',
                color: 'var(--bg-primary)',
                fontSize: '14px',
                fontWeight: '600',
                cursor: 'pointer',
                transition: 'all 0.15s ease',
            },
            buttonSecondary: {
                background: 'var(--bg-tertiary)',
                color: 'var(--text-primary)',
                border: '1px solid var(--border-subtle)',
            },
            buttonDanger: {
                background: 'var(--accent-red)',
            },
            toolbar: {
                position: 'absolute',
                bottom: '20px',
                left: '50%',
                transform: 'translateX(-50%)',
                display: 'flex',
                gap: '8px',
                padding: '8px',
                background: 'var(--bg-secondary)',
                borderRadius: '12px',
                border: '1px solid var(--border-subtle)',
                boxShadow: '0 4px 20px rgba(0,0,0,0.4)',
                zIndex: 50,
            },
            mobileMenu: {
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'var(--bg-secondary)',
                zIndex: 200,
                overflow: 'auto',
                animation: 'slideUp 0.2s ease',
            },
            tabBar: {
                display: 'flex',
                borderBottom: '1px solid var(--border-subtle)',
            },
            tab: {
                flex: 1,
                padding: '14px',
                textAlign: 'center',
                fontSize: '13px',
                fontWeight: '500',
                color: 'var(--text-secondary)',
                background: 'transparent',
                border: 'none',
                cursor: 'pointer',
                borderBottom: '2px solid transparent',
                transition: 'all 0.15s ease',
            },
            tabActive: {
                color: 'var(--accent-amber)',
                borderBottomColor: 'var(--accent-amber)',
            },
            propertiesPanel: {
                position: 'absolute',
                top: '70px',
                right: '20px',
                width: '280px',
                background: 'var(--bg-secondary)',
                borderRadius: '12px',
                border: '1px solid var(--border-subtle)',
                boxShadow: '0 4px 20px rgba(0,0,0,0.4)',
                zIndex: 50,
                overflow: 'hidden',
            },
            wireInfo: {
                position: 'absolute',
                padding: '6px 10px',
                background: 'var(--bg-elevated)',
                border: '1px solid var(--border-subtle)',
                borderRadius: '6px',
                fontSize: '11px',
                fontFamily: "'JetBrains Mono', monospace",
                color: 'var(--text-secondary)',
                pointerEvents: 'none',
                whiteSpace: 'nowrap',
                zIndex: 5,
            },
        };

        // Component: Part Item in Library
        function PartLibraryItem({ part, onDragStart, onEdit }) {
            return (
                <div
                    style={styles.partItem}
                    draggable
                    onDragStart={(e) => onDragStart(e, part)}
                    onTouchStart={(e) => onDragStart(e, part)}
                >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <div>
                            <div style={styles.partItemName}>{part.name}</div>
                            <div style={styles.partItemCategory}>{part.pins.length} pins</div>
                        </div>
                        {onEdit && (
                            <button
                                style={{ ...styles.iconButton, width: '32px', height: '32px' }}
                                onClick={(e) => { e.stopPropagation(); onEdit(part); }}
                            >
                                <Icons.Edit />
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        // Component: Canvas Component (placed part)
        function CanvasComponent({ component, selected, onSelect, onDrag, onPinClick, scale }) {
            const ref = useRef(null);
            const [isDragging, setIsDragging] = useState(false);
            const dragOffset = useRef({ x: 0, y: 0 });

            const handleMouseDown = (e) => {
                if (e.target.closest('.pin')) return;
                e.stopPropagation();
                onSelect(component.id);
                setIsDragging(true);
                const rect = ref.current.getBoundingClientRect();
                dragOffset.current = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            };

            const handleTouchStart = (e) => {
                if (e.target.closest('.pin')) return;
                e.stopPropagation();
                onSelect(component.id);
                setIsDragging(true);
                const touch = e.touches[0];
                const rect = ref.current.getBoundingClientRect();
                dragOffset.current = {
                    x: touch.clientX - rect.left,
                    y: touch.clientY - rect.top
                };
            };

            useEffect(() => {
                if (!isDragging) return;

                const handleMove = (e) => {
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    const canvas = ref.current.parentElement;
                    const canvasRect = canvas.getBoundingClientRect();
                    
                    const newX = (clientX - canvasRect.left - dragOffset.current.x) / scale;
                    const newY = (clientY - canvasRect.top - dragOffset.current.y) / scale;
                    
                    onDrag(component.id, newX, newY);
                };

                const handleEnd = () => setIsDragging(false);

                window.addEventListener('mousemove', handleMove);
                window.addEventListener('mouseup', handleEnd);
                window.addEventListener('touchmove', handleMove, { passive: false });
                window.addEventListener('touchend', handleEnd);

                return () => {
                    window.removeEventListener('mousemove', handleMove);
                    window.removeEventListener('mouseup', handleEnd);
                    window.removeEventListener('touchmove', handleMove);
                    window.removeEventListener('touchend', handleEnd);
                };
            }, [isDragging, scale]);

            const leftPins = component.pins.filter(p => p.position === 'left').sort((a, b) => a.index - b.index);
            const rightPins = component.pins.filter(p => p.position === 'right').sort((a, b) => a.index - b.index);
            const topPins = component.pins.filter(p => p.position === 'top').sort((a, b) => a.index - b.index);
            const bottomPins = component.pins.filter(p => p.position === 'bottom').sort((a, b) => a.index - b.index);

            const pinType = (type) => PIN_TYPES.find(t => t.id === type) || PIN_TYPES[2];

            return (
                <div
                    ref={ref}
                    style={{
                        ...styles.component,
                        ...(selected ? styles.componentSelected : {}),
                        left: component.x,
                        top: component.y,
                        width: component.width,
                        minHeight: component.height,
                    }}
                    onMouseDown={handleMouseDown}
                    onTouchStart={handleTouchStart}
                >
                    <div style={styles.componentHeader}>{component.name}</div>
                    
                    {topPins.length > 0 && (
                        <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', padding: '4px' }}>
                            {topPins.map(pin => (
                                <div
                                    key={pin.id}
                                    className="pin"
                                    style={{ ...styles.pin, flexDirection: 'column', padding: '4px' }}
                                    onClick={() => onPinClick(component.id, pin.id)}
                                    data-pin-id={pin.id}
                                >
                                    <div style={{ ...styles.pinDot, background: pinType(pin.type).color }} />
                                    <span style={styles.pinLabel}>{pin.label}</span>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    <div style={styles.componentBody}>
                        <div style={styles.pinColumn}>
                            {leftPins.map(pin => (
                                <div
                                    key={pin.id}
                                    className="pin"
                                    style={styles.pin}
                                    onClick={() => onPinClick(component.id, pin.id)}
                                    data-pin-id={pin.id}
                                >
                                    <div style={{ ...styles.pinDot, background: pinType(pin.type).color }} />
                                    <span style={styles.pinLabel}>{pin.label}</span>
                                </div>
                            ))}
                        </div>
                        <div style={{ ...styles.pinColumn, alignItems: 'flex-end' }}>
                            {rightPins.map(pin => (
                                <div
                                    key={pin.id}
                                    className="pin"
                                    style={{ ...styles.pin, flexDirection: 'row-reverse' }}
                                    onClick={() => onPinClick(component.id, pin.id)}
                                    data-pin-id={pin.id}
                                >
                                    <div style={{ ...styles.pinDot, background: pinType(pin.type).color }} />
                                    <span style={styles.pinLabel}>{pin.label}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    {bottomPins.length > 0 && (
                        <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', padding: '4px' }}>
                            {bottomPins.map(pin => (
                                <div
                                    key={pin.id}
                                    className="pin"
                                    style={{ ...styles.pin, flexDirection: 'column-reverse', padding: '4px' }}
                                    onClick={() => onPinClick(component.id, pin.id)}
                                    data-pin-id={pin.id}
                                >
                                    <div style={{ ...styles.pinDot, background: pinType(pin.type).color }} />
                                    <span style={styles.pinLabel}>{pin.label}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Component: Wire
        function Wire({ wire, components, selected, onSelect }) {
            const getEndpointPosition = (endpoint) => {
                const comp = components.find(c => c.id === endpoint.componentId);
                if (!comp) return null;
                
                const pin = comp.pins.find(p => p.id === endpoint.pinId);
                if (!pin) return null;

                const samePosPins = comp.pins.filter(p => p.position === pin.position).sort((a, b) => a.index - b.index);
                const pinIndex = samePosPins.findIndex(p => p.id === pin.id);
                const pinSpacing = 22;
                const headerHeight = 32;
                const pinStartY = headerHeight + 12;

                let x, y;
                
                switch (pin.position) {
                    case 'left':
                        x = comp.x;
                        y = comp.y + pinStartY + pinIndex * pinSpacing;
                        break;
                    case 'right':
                        x = comp.x + comp.width;
                        y = comp.y + pinStartY + pinIndex * pinSpacing;
                        break;
                    case 'top':
                        x = comp.x + comp.width / 2 + (pinIndex - samePosPins.length / 2 + 0.5) * 40;
                        y = comp.y + headerHeight;
                        break;
                    case 'bottom':
                        x = comp.x + comp.width / 2 + (pinIndex - samePosPins.length / 2 + 0.5) * 40;
                        y = comp.y + comp.height;
                        break;
                    default:
                        x = comp.x;
                        y = comp.y;
                }
                
                return { x, y };
            };

            const start = getEndpointPosition(wire.start);
            const end = getEndpointPosition(wire.end);
            
            if (!start || !end) return null;

            const wireColor = WIRE_COLORS.find(c => c.id === wire.color)?.hex || '#3b82f6';
            
            // Create path with routing
            const midX = (start.x + end.x) / 2;
            const path = `M ${start.x} ${start.y} C ${midX} ${start.y}, ${midX} ${end.y}, ${end.x} ${end.y}`;

            // Calculate label position
            const labelX = (start.x + end.x) / 2;
            const labelY = (start.y + end.y) / 2 - 10;

            return (
                <g onClick={() => onSelect(wire.id)} style={{ cursor: 'pointer' }}>
                    {/* Hit area */}
                    <path
                        d={path}
                        fill="none"
                        stroke="transparent"
                        strokeWidth="16"
                    />
                    {/* Visible wire */}
                    <path
                        d={path}
                        fill="none"
                        stroke={wireColor}
                        strokeWidth={selected ? 4 : 3}
                        strokeLinecap="round"
                        style={{
                            filter: selected ? 'drop-shadow(0 0 4px ' + wireColor + ')' : 'none',
                            transition: 'all 0.15s ease',
                        }}
                    />
                    {/* Wire info label */}
                    {(wire.gauge || wire.connectorType) && (
                        <foreignObject x={labelX - 50} y={labelY - 10} width="100" height="30">
                            <div style={{
                                ...styles.wireInfo,
                                background: selected ? 'var(--accent-amber)' : 'var(--bg-elevated)',
                                color: selected ? 'var(--bg-primary)' : 'var(--text-secondary)',
                                textAlign: 'center',
                            }}>
                                {wire.gauge} {wire.connectorType && `• ${wire.connectorType}`}
                            </div>
                        </foreignObject>
                    )}
                </g>
            );
        }

        // Modal: Part Editor
        function PartEditorModal({ part, onSave, onClose }) {
            const [name, setName] = useState(part?.name || '');
            const [category, setCategory] = useState(part?.category || 'Custom');
            const [width, setWidth] = useState(part?.width || 120);
            const [height, setHeight] = useState(part?.height || 80);
            const [pins, setPins] = useState(part?.pins || []);

            const addPin = () => {
                setPins([...pins, {
                    id: `p${pins.length + 1}`,
                    label: `Pin ${pins.length + 1}`,
                    type: 'signal',
                    position: 'left',
                    index: pins.filter(p => p.position === 'left').length,
                }]);
            };

            const updatePin = (index, field, value) => {
                const newPins = [...pins];
                newPins[index] = { ...newPins[index], [field]: value };
                
                // Recalculate indices when position changes
                if (field === 'position') {
                    const position = value;
                    const pinsInPosition = newPins.filter((p, i) => i !== index && p.position === position);
                    newPins[index].index = pinsInPosition.length;
                }
                
                setPins(newPins);
            };

            const removePin = (index) => {
                setPins(pins.filter((_, i) => i !== index));
            };

            const handleSave = () => {
                onSave({
                    id: part?.id || generateId(),
                    name,
                    category,
                    width: parseInt(width),
                    height: parseInt(height),
                    pins,
                });
            };

            return (
                <div style={styles.modal} onClick={onClose}>
                    <div style={styles.modalContent} onClick={e => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <span style={styles.modalTitle}>{part ? 'Edit Part' : 'Create Part'}</span>
                            <button style={styles.iconButton} onClick={onClose}>
                                <Icons.X />
                            </button>
                        </div>
                        <div style={styles.modalBody}>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Part Name</label>
                                <input
                                    style={styles.input}
                                    value={name}
                                    onChange={e => setName(e.target.value)}
                                    placeholder="e.g., MoTeC M150"
                                />
                            </div>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Category</label>
                                <select style={styles.select} value={category} onChange={e => setCategory(e.target.value)}>
                                    <option>ECU</option>
                                    <option>Relay</option>
                                    <option>Fuse</option>
                                    <option>Switch</option>
                                    <option>Sensor</option>
                                    <option>Connector</option>
                                    <option>Power</option>
                                    <option>Ignition</option>
                                    <option>Fuel</option>
                                    <option>Custom</option>
                                </select>
                            </div>
                            <div style={{ display: 'flex', gap: '12px' }}>
                                <div style={{ ...styles.formGroup, flex: 1 }}>
                                    <label style={styles.label}>Width</label>
                                    <input
                                        style={styles.input}
                                        type="number"
                                        value={width}
                                        onChange={e => setWidth(e.target.value)}
                                    />
                                </div>
                                <div style={{ ...styles.formGroup, flex: 1 }}>
                                    <label style={styles.label}>Height</label>
                                    <input
                                        style={styles.input}
                                        type="number"
                                        value={height}
                                        onChange={e => setHeight(e.target.value)}
                                    />
                                </div>
                            </div>
                            
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '20px', marginBottom: '12px' }}>
                                <span style={styles.label}>Pins ({pins.length})</span>
                                <button style={{ ...styles.button, padding: '6px 12px', fontSize: '12px' }} onClick={addPin}>
                                    <Icons.Plus /> Add Pin
                                </button>
                            </div>
                            
                            <div style={{ maxHeight: '200px', overflow: 'auto' }}>
                                {pins.map((pin, index) => (
                                    <div key={index} style={{
                                        display: 'flex',
                                        gap: '8px',
                                        padding: '8px',
                                        background: 'var(--bg-tertiary)',
                                        borderRadius: '6px',
                                        marginBottom: '8px',
                                        alignItems: 'center',
                                    }}>
                                        <input
                                            style={{ ...styles.input, width: '80px' }}
                                            value={pin.label}
                                            onChange={e => updatePin(index, 'label', e.target.value)}
                                            placeholder="Label"
                                        />
                                        <select
                                            style={{ ...styles.select, width: '100px' }}
                                            value={pin.type}
                                            onChange={e => updatePin(index, 'type', e.target.value)}
                                        >
                                            {PIN_TYPES.map(t => (
                                                <option key={t.id} value={t.id}>{t.name}</option>
                                            ))}
                                        </select>
                                        <select
                                            style={{ ...styles.select, width: '80px' }}
                                            value={pin.position}
                                            onChange={e => updatePin(index, 'position', e.target.value)}
                                        >
                                            <option value="left">Left</option>
                                            <option value="right">Right</option>
                                            <option value="top">Top</option>
                                            <option value="bottom">Bottom</option>
                                        </select>
                                        <button
                                            style={{ ...styles.iconButton, width: '32px', height: '32px', color: 'var(--accent-red)' }}
                                            onClick={() => removePin(index)}
                                        >
                                            <Icons.Trash />
                                        </button>
                                    </div>
                                ))}
                            </div>
                            
                            <div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}>
                                <button style={{ ...styles.button, ...styles.buttonSecondary, flex: 1 }} onClick={onClose}>
                                    Cancel
                                </button>
                                <button style={{ ...styles.button, flex: 1 }} onClick={handleSave}>
                                    Save Part
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Modal: Wire Editor
        function WireEditorModal({ wire, onSave, onDelete, onClose }) {
            const [color, setColor] = useState(wire?.color || 'red');
            const [gauge, setGauge] = useState(wire?.gauge || '18 AWG');
            const [connectorType, setConnectorType] = useState(wire?.connectorType || '');

            const handleSave = () => {
                onSave({ ...wire, color, gauge, connectorType });
            };

            return (
                <div style={styles.modal} onClick={onClose}>
                    <div style={styles.modalContent} onClick={e => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <span style={styles.modalTitle}>Edit Wire</span>
                            <button style={styles.iconButton} onClick={onClose}>
                                <Icons.X />
                            </button>
                        </div>
                        <div style={styles.modalBody}>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Wire Color</label>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '8px' }}>
                                    {WIRE_COLORS.map(c => (
                                        <button
                                            key={c.id}
                                            onClick={() => setColor(c.id)}
                                            style={{
                                                padding: '8px',
                                                background: c.hex,
                                                border: color === c.id ? '3px solid var(--accent-amber)' : '3px solid transparent',
                                                borderRadius: '6px',
                                                cursor: 'pointer',
                                                color: ['black', 'dk-green', 'dk-blue', 'brown'].includes(c.id) ? '#fff' : '#000',
                                                fontSize: '11px',
                                                fontWeight: '500',
                                            }}
                                        >
                                            {c.name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Wire Gauge</label>
                                <select style={styles.select} value={gauge} onChange={e => setGauge(e.target.value)}>
                                    {WIRE_GAUGES.map(g => (
                                        <option key={g} value={g}>{g}</option>
                                    ))}
                                </select>
                            </div>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Connector Type</label>
                                <select style={styles.select} value={connectorType} onChange={e => setConnectorType(e.target.value)}>
                                    <option value="">None</option>
                                    {CONNECTOR_TYPES.map(t => (
                                        <option key={t} value={t}>{t}</option>
                                    ))}
                                </select>
                            </div>
                            <div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}>
                                <button style={{ ...styles.button, ...styles.buttonDanger }} onClick={() => { onDelete(wire.id); onClose(); }}>
                                    <Icons.Trash /> Delete
                                </button>
                                <button style={{ ...styles.button, flex: 1 }} onClick={handleSave}>
                                    Save Wire
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Main App
        function App() {
            const [parts, setParts] = useState(DEFAULT_PARTS);
            const [components, setComponents] = useState([]);
            const [wires, setWires] = useState([]);
            const [selectedComponent, setSelectedComponent] = useState(null);
            const [selectedWire, setSelectedWire] = useState(null);
            const [wireStart, setWireStart] = useState(null);
            const [scale, setScale] = useState(1);
            const [offset, setOffset] = useState({ x: 0, y: 0 });
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [mobileTab, setMobileTab] = useState('parts');
            const [editingPart, setEditingPart] = useState(null);
            const [editingWire, setEditingWire] = useState(null);
            const [projectName, setProjectName] = useState('Untitled Project');
            const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
            
            const canvasRef = useRef(null);
            const fileInputRef = useRef(null);
            const importPartsRef = useRef(null);

            useEffect(() => {
                const handleResize = () => setIsMobile(window.innerWidth < 768);
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            // Load saved project
            useEffect(() => {
                const saved = localStorage.getItem('wirepro-project');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        if (data.components) setComponents(data.components);
                        if (data.wires) setWires(data.wires);
                        if (data.projectName) setProjectName(data.projectName);
                        if (data.parts) setParts([...DEFAULT_PARTS, ...data.parts.filter(p => !DEFAULT_PARTS.find(d => d.id === p.id))]);
                    } catch (e) {
                        console.error('Failed to load project:', e);
                    }
                }
            }, []);

            // Auto-save
            useEffect(() => {
                const data = {
                    components,
                    wires,
                    projectName,
                    parts: parts.filter(p => !DEFAULT_PARTS.find(d => d.id === p.id)),
                };
                localStorage.setItem('wirepro-project', JSON.stringify(data));
            }, [components, wires, projectName, parts]);

            const handleDragStart = (e, part) => {
                e.dataTransfer?.setData('part', JSON.stringify(part));
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const partData = e.dataTransfer?.getData('part');
                if (!partData) return;

                const part = JSON.parse(partData);
                const rect = canvasRef.current.getBoundingClientRect();
                const x = (e.clientX - rect.left - offset.x) / scale;
                const y = (e.clientY - rect.top - offset.y) / scale;

                const newComponent = {
                    ...part,
                    id: generateId(),
                    x: Math.round(x / 20) * 20,
                    y: Math.round(y / 20) * 20,
                    pins: part.pins.map(p => ({ ...p, id: generateId() })),
                };

                setComponents([...components, newComponent]);
            };

            const handleComponentDrag = (id, x, y) => {
                setComponents(components.map(c =>
                    c.id === id ? { ...c, x: Math.round(x / 20) * 20, y: Math.round(y / 20) * 20 } : c
                ));
            };

            const handlePinClick = (componentId, pinId) => {
                if (!wireStart) {
                    setWireStart({ componentId, pinId });
                } else if (wireStart.componentId !== componentId) {
                    const newWire = {
                        id: generateId(),
                        start: wireStart,
                        end: { componentId, pinId },
                        color: 'red',
                        gauge: '18 AWG',
                        connectorType: '',
                    };
                    setWires([...wires, newWire]);
                    setWireStart(null);
                    setEditingWire(newWire);
                } else {
                    setWireStart(null);
                }
            };

            const handleSavePart = (part) => {
                if (editingPart?.id) {
                    setParts(parts.map(p => p.id === part.id ? part : p));
                } else {
                    setParts([...parts, part]);
                }
                setEditingPart(null);
            };

            const handleSaveWire = (wire) => {
                setWires(wires.map(w => w.id === wire.id ? wire : w));
                setEditingWire(null);
            };

            const handleDeleteWire = (id) => {
                setWires(wires.filter(w => w.id !== id));
                setSelectedWire(null);
            };

            const handleDeleteComponent = () => {
                if (!selectedComponent) return;
                setWires(wires.filter(w =>
                    w.start.componentId !== selectedComponent && w.end.componentId !== selectedComponent
                ));
                setComponents(components.filter(c => c.id !== selectedComponent));
                setSelectedComponent(null);
            };

            const handleExportPNG = async () => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                // Create a clean export version
                const exportDiv = document.createElement('div');
                exportDiv.style.position = 'fixed';
                exportDiv.style.left = '-9999px';
                exportDiv.style.background = '#0a0a0a';
                exportDiv.style.padding = '40px';
                exportDiv.innerHTML = canvas.innerHTML;
                document.body.appendChild(exportDiv);

                // Add title
                const title = document.createElement('div');
                title.style.cssText = `
                    font-family: 'JetBrains Mono', monospace;
                    font-size: 24px;
                    font-weight: 700;
                    color: #f5f5f5;
                    margin-bottom: 20px;
                    text-align: center;
                `;
                title.textContent = projectName;
                exportDiv.insertBefore(title, exportDiv.firstChild);

                try {
                    const dataUrl = await html2canvas(exportDiv, {
                        backgroundColor: '#0a0a0a',
                        scale: 2,
                    }).then(c => c.toDataURL('image/png'));

                    const link = document.createElement('a');
                    link.download = `${projectName.replace(/\s+/g, '-')}.png`;
                    link.href = dataUrl;
                    link.click();
                } catch (e) {
                    console.error('Export failed:', e);
                    alert('Export failed. Please try again.');
                } finally {
                    document.body.removeChild(exportDiv);
                }
            };

            const handleExportDiagram = async () => {
                // Calculate bounds of all components
                if (components.length === 0) {
                    alert('Add some components first!');
                    return;
                }

                let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
                components.forEach(c => {
                    minX = Math.min(minX, c.x);
                    minY = Math.min(minY, c.y);
                    maxX = Math.max(maxX, c.x + c.width);
                    maxY = Math.max(maxY, c.y + c.height);
                });

                // Build wire legend data
                const wireData = wires.map(w => {
                    const startComp = components.find(c => c.id === w.start.componentId);
                    const endComp = components.find(c => c.id === w.end.componentId);
                    const startPin = startComp?.pins.find(p => p.id === w.start.pinId);
                    const endPin = endComp?.pins.find(p => p.id === w.end.pinId);
                    return {
                        from: `${startComp?.name || '?'} - ${startPin?.label || '?'}`,
                        to: `${endComp?.name || '?'} - ${endPin?.label || '?'}`,
                        color: WIRE_COLORS.find(c => c.id === w.color)?.name || w.color,
                        colorHex: WIRE_COLORS.find(c => c.id === w.color)?.hex || '#888',
                        gauge: w.gauge || '-',
                        connector: w.connectorType || '-',
                    };
                });

                // Create export container - 11x8.5 landscape ratio (1056x816 at 96dpi, we'll use 2x)
                const pageWidth = 2112;
                const pageHeight = 1632;
                const margin = 60;
                const headerHeight = 120;
                const legendWidth = 500;

                const exportDiv = document.createElement('div');
                exportDiv.style.cssText = `
                    position: fixed;
                    left: -9999px;
                    width: ${pageWidth}px;
                    height: ${pageHeight}px;
                    background: #0a0a0a;
                    font-family: 'Outfit', sans-serif;
                    overflow: hidden;
                `;
                document.body.appendChild(exportDiv);

                // Header
                const header = document.createElement('div');
                header.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: ${headerHeight}px;
                    background: linear-gradient(135deg, #141414 0%, #1a1a1a 100%);
                    border-bottom: 3px solid #f59e0b;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 0 ${margin}px;
                `;
                header.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2.5">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                        <div>
                            <div style="font-family: 'JetBrains Mono', monospace; font-size: 32px; font-weight: 700; color: #f5f5f5; letter-spacing: -1px;">${projectName}</div>
                            <div style="font-size: 14px; color: #666; margin-top: 4px;">WIRING DIAGRAM</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 14px; color: #666;">Created with WirePro</div>
                        <div style="font-size: 14px; color: #888; margin-top: 4px;">${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                    </div>
                `;
                exportDiv.appendChild(header);

                // Diagram area
                const diagramArea = document.createElement('div');
                const diagramWidth = pageWidth - legendWidth - margin * 3;
                const diagramHeight = pageHeight - headerHeight - margin * 2;
                
                // Calculate scale to fit diagram
                const contentWidth = maxX - minX + 100;
                const contentHeight = maxY - minY + 100;
                const scaleX = diagramWidth / contentWidth;
                const scaleY = diagramHeight / contentHeight;
                const diagramScale = Math.min(scaleX, scaleY, 1.5);

                diagramArea.style.cssText = `
                    position: absolute;
                    top: ${headerHeight + margin}px;
                    left: ${margin}px;
                    width: ${diagramWidth}px;
                    height: ${diagramHeight}px;
                    background: #0f0f0f;
                    border: 2px solid #2a2a2a;
                    border-radius: 12px;
                    overflow: hidden;
                `;

                // Grid pattern
                const grid = document.createElement('div');
                grid.style.cssText = `
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background-image: linear-gradient(#1a1a1a 1px, transparent 1px), linear-gradient(90deg, #1a1a1a 1px, transparent 1px);
                    background-size: 30px 30px;
                    opacity: 0.5;
                `;
                diagramArea.appendChild(grid);

                // Centered content container
                const contentContainer = document.createElement('div');
                const offsetX = (diagramWidth - contentWidth * diagramScale) / 2 - minX * diagramScale + 50;
                const offsetY = (diagramHeight - contentHeight * diagramScale) / 2 - minY * diagramScale + 50;
                contentContainer.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    transform: translate(${offsetX}px, ${offsetY}px) scale(${diagramScale});
                    transform-origin: 0 0;
                `;

                // Draw wires as SVG
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '4000');
                svg.setAttribute('height', '4000');
                svg.style.cssText = 'position: absolute; top: 0; left: 0; overflow: visible;';

                wires.forEach(wire => {
                    const getPos = (endpoint) => {
                        const comp = components.find(c => c.id === endpoint.componentId);
                        if (!comp) return null;
                        const pin = comp.pins.find(p => p.id === endpoint.pinId);
                        if (!pin) return null;
                        const samePosPins = comp.pins.filter(p => p.position === pin.position).sort((a, b) => a.index - b.index);
                        const pinIndex = samePosPins.findIndex(p => p.id === pin.id);
                        const pinSpacing = 22;
                        const headerH = 32;
                        const pinStartY = headerH + 12;
                        let x, y;
                        switch (pin.position) {
                            case 'left': x = comp.x; y = comp.y + pinStartY + pinIndex * pinSpacing; break;
                            case 'right': x = comp.x + comp.width; y = comp.y + pinStartY + pinIndex * pinSpacing; break;
                            case 'top': x = comp.x + comp.width / 2; y = comp.y + headerH; break;
                            case 'bottom': x = comp.x + comp.width / 2; y = comp.y + comp.height; break;
                            default: x = comp.x; y = comp.y;
                        }
                        return { x, y };
                    };

                    const start = getPos(wire.start);
                    const end = getPos(wire.end);
                    if (!start || !end) return;

                    const wireColor = WIRE_COLORS.find(c => c.id === wire.color)?.hex || '#3b82f6';
                    const midX = (start.x + end.x) / 2;
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', `M ${start.x} ${start.y} C ${midX} ${start.y}, ${midX} ${end.y}, ${end.x} ${end.y}`);
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke', wireColor);
                    path.setAttribute('stroke-width', '3');
                    path.setAttribute('stroke-linecap', 'round');
                    svg.appendChild(path);
                });
                contentContainer.appendChild(svg);

                // Draw components
                components.forEach(comp => {
                    const compDiv = document.createElement('div');
                    compDiv.style.cssText = `
                        position: absolute;
                        left: ${comp.x}px;
                        top: ${comp.y}px;
                        width: ${comp.width}px;
                        min-height: ${comp.height}px;
                        background: #222222;
                        border: 2px solid #3a3a3a;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    `;

                    const headerDiv = document.createElement('div');
                    headerDiv.style.cssText = `
                        padding: 8px 10px;
                        border-bottom: 1px solid #2a2a2a;
                        font-size: 12px;
                        font-weight: 600;
                        font-family: 'JetBrains Mono', monospace;
                        color: #f5f5f5;
                        text-align: center;
                        background: #1a1a1a;
                        border-radius: 6px 6px 0 0;
                    `;
                    headerDiv.textContent = comp.name;
                    compDiv.appendChild(headerDiv);

                    const bodyDiv = document.createElement('div');
                    bodyDiv.style.cssText = `
                        display: flex;
                        justify-content: space-between;
                        padding: 8px 0;
                        min-height: 40px;
                    `;

                    const leftPins = comp.pins.filter(p => p.position === 'left').sort((a, b) => a.index - b.index);
                    const rightPins = comp.pins.filter(p => p.position === 'right').sort((a, b) => a.index - b.index);

                    const leftCol = document.createElement('div');
                    leftCol.style.cssText = 'display: flex; flex-direction: column; gap: 4px;';
                    leftPins.forEach(pin => {
                        const pinType = PIN_TYPES.find(t => t.id === pin.type) || PIN_TYPES[2];
                        const pinDiv = document.createElement('div');
                        pinDiv.style.cssText = `
                            display: flex;
                            align-items: center;
                            gap: 6px;
                            padding: 4px 8px;
                            font-size: 11px;
                            font-family: 'JetBrains Mono', monospace;
                        `;
                        pinDiv.innerHTML = `
                            <div style="width: 10px; height: 10px; border-radius: 50%; background: ${pinType.color}; border: 2px solid #0a0a0a;"></div>
                            <span style="color: #a0a0a0;">${pin.label}</span>
                        `;
                        leftCol.appendChild(pinDiv);
                    });
                    bodyDiv.appendChild(leftCol);

                    const rightCol = document.createElement('div');
                    rightCol.style.cssText = 'display: flex; flex-direction: column; gap: 4px; align-items: flex-end;';
                    rightPins.forEach(pin => {
                        const pinType = PIN_TYPES.find(t => t.id === pin.type) || PIN_TYPES[2];
                        const pinDiv = document.createElement('div');
                        pinDiv.style.cssText = `
                            display: flex;
                            align-items: center;
                            gap: 6px;
                            padding: 4px 8px;
                            font-size: 11px;
                            font-family: 'JetBrains Mono', monospace;
                            flex-direction: row-reverse;
                        `;
                        pinDiv.innerHTML = `
                            <div style="width: 10px; height: 10px; border-radius: 50%; background: ${pinType.color}; border: 2px solid #0a0a0a;"></div>
                            <span style="color: #a0a0a0;">${pin.label}</span>
                        `;
                        rightCol.appendChild(pinDiv);
                    });
                    bodyDiv.appendChild(rightCol);

                    compDiv.appendChild(bodyDiv);
                    contentContainer.appendChild(compDiv);
                });

                diagramArea.appendChild(contentContainer);
                exportDiv.appendChild(diagramArea);

                // Wire Legend / Connection Table
                const legend = document.createElement('div');
                legend.style.cssText = `
                    position: absolute;
                    top: ${headerHeight + margin}px;
                    right: ${margin}px;
                    width: ${legendWidth - margin}px;
                    height: ${diagramHeight}px;
                    background: #141414;
                    border: 2px solid #2a2a2a;
                    border-radius: 12px;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                `;

                const legendHeader = document.createElement('div');
                legendHeader.style.cssText = `
                    padding: 16px 20px;
                    background: #1a1a1a;
                    border-bottom: 2px solid #2a2a2a;
                    font-size: 14px;
                    font-weight: 600;
                    color: #f59e0b;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                `;
                legendHeader.textContent = 'Connection Table';
                legend.appendChild(legendHeader);

                // Table header
                const tableHeader = document.createElement('div');
                tableHeader.style.cssText = `
                    display: grid;
                    grid-template-columns: 1fr 1fr 70px 70px;
                    padding: 12px 16px;
                    background: #1a1a1a;
                    border-bottom: 1px solid #2a2a2a;
                    font-size: 10px;
                    font-weight: 600;
                    color: #666;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                `;
                tableHeader.innerHTML = '<span>From</span><span>To</span><span>Color</span><span>Gauge</span>';
                legend.appendChild(tableHeader);

                const tableBody = document.createElement('div');
                tableBody.style.cssText = `
                    flex: 1;
                    overflow: auto;
                `;

                if (wireData.length === 0) {
                    const emptyRow = document.createElement('div');
                    emptyRow.style.cssText = `
                        padding: 20px;
                        text-align: center;
                        color: #666;
                        font-size: 12px;
                    `;
                    emptyRow.textContent = 'No connections yet';
                    tableBody.appendChild(emptyRow);
                } else {
                    wireData.forEach((w, i) => {
                        const row = document.createElement('div');
                        row.style.cssText = `
                            display: grid;
                            grid-template-columns: 1fr 1fr 70px 70px;
                            padding: 10px 16px;
                            border-bottom: 1px solid #222;
                            font-size: 11px;
                            color: #ccc;
                            background: ${i % 2 === 0 ? 'transparent' : '#1a1a1a'};
                            align-items: center;
                        `;
                        row.innerHTML = `
                            <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 8px;">${w.from}</span>
                            <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 8px;">${w.to}</span>
                            <span style="display: flex; align-items: center; gap: 6px;">
                                <span style="width: 12px; height: 12px; border-radius: 3px; background: ${w.colorHex}; border: 1px solid #444;"></span>
                                <span style="font-size: 10px;">${w.color}</span>
                            </span>
                            <span style="font-size: 10px;">${w.gauge}</span>
                        `;
                        tableBody.appendChild(row);
                    });
                }
                legend.appendChild(tableBody);

                // Pin type legend
                const pinLegend = document.createElement('div');
                pinLegend.style.cssText = `
                    padding: 12px 16px;
                    background: #1a1a1a;
                    border-top: 2px solid #2a2a2a;
                `;
                pinLegend.innerHTML = `
                    <div style="font-size: 10px; font-weight: 600; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Pin Types</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${PIN_TYPES.map(t => `
                            <span style="display: flex; align-items: center; gap: 4px; font-size: 9px; color: #888;">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: ${t.color};"></span>
                                ${t.name}
                            </span>
                        `).join('')}
                    </div>
                `;
                legend.appendChild(pinLegend);

                exportDiv.appendChild(legend);

                // Footer
                const footer = document.createElement('div');
                footer.style.cssText = `
                    position: absolute;
                    bottom: 10px;
                    left: ${margin}px;
                    right: ${margin}px;
                    display: flex;
                    justify-content: space-between;
                    font-size: 10px;
                    color: #444;
                `;
                footer.innerHTML = `
                    <span>Boris Enterprises</span>
                    <span>Page 1 of 1</span>
                `;
                exportDiv.appendChild(footer);

                try {
                    const dataUrl = await html2canvas(exportDiv, {
                        backgroundColor: '#0a0a0a',
                        scale: 1,
                        width: pageWidth,
                        height: pageHeight,
                    }).then(c => c.toDataURL('image/png'));

                    const link = document.createElement('a');
                    link.download = `${projectName.replace(/\s+/g, '-')}-diagram.png`;
                    link.href = dataUrl;
                    link.click();
                } catch (e) {
                    console.error('Export failed:', e);
                    alert('Export failed. Please try again.');
                } finally {
                    document.body.removeChild(exportDiv);
                }
            };

            const handleSaveProject = () => {
                const data = {
                    projectName,
                    components,
                    wires,
                    parts: parts.filter(p => !DEFAULT_PARTS.find(d => d.id === p.id)),
                    version: '1.0',
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.download = `${projectName.replace(/\s+/g, '-')}.wirepro`;
                link.href = URL.createObjectURL(blob);
                link.click();
            };

            const handleLoadProject = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.components) setComponents(data.components);
                        if (data.wires) setWires(data.wires);
                        if (data.projectName) setProjectName(data.projectName);
                        if (data.parts) {
                            setParts([...DEFAULT_PARTS, ...data.parts]);
                        }
                    } catch (err) {
                        alert('Invalid project file');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const handleImportParts = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        const newParts = Array.isArray(data) ? data : [data];
                        const validParts = newParts.filter(p => p.name && p.pins);
                        setParts([...parts, ...validParts.map(p => ({ ...p, id: generateId() }))]);
                        alert(`Imported ${validParts.length} parts`);
                    } catch (err) {
                        alert('Invalid parts file. Expected JSON format.');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const handleExportParts = () => {
                const customParts = parts.filter(p => !DEFAULT_PARTS.find(d => d.id === p.id));
                const blob = new Blob([JSON.stringify(customParts, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.download = 'custom-parts.json';
                link.href = URL.createObjectURL(blob);
                link.click();
            };

            const handleCanvasClick = (e) => {
                if (e.target === e.currentTarget || e.target.classList.contains('grid-pattern')) {
                    setSelectedComponent(null);
                    setSelectedWire(null);
                    setWireStart(null);
                }
            };

            const handleAddMobilePart = (part) => {
                const newComponent = {
                    ...part,
                    id: generateId(),
                    x: 100,
                    y: 100,
                    pins: part.pins.map(p => ({ ...p, id: generateId() })),
                };
                setComponents([...components, newComponent]);
                setShowMobileMenu(false);
            };

            const groupedParts = useMemo(() => {
                const groups = {};
                parts.forEach(part => {
                    if (!groups[part.category]) groups[part.category] = [];
                    groups[part.category].push(part);
                });
                return groups;
            }, [parts]);

            return (
                <div style={styles.app}>
                    {/* Header */}
                    <header style={styles.header}>
                        <div style={styles.logo}>
                            <div style={styles.logoIcon}><Icons.Zap /></div>
                            <span style={styles.logoText}>WirePro</span>
                        </div>
                        
                        {!isMobile && (
                            <input
                                style={{ ...styles.input, width: '200px', textAlign: 'center' }}
                                value={projectName}
                                onChange={e => setProjectName(e.target.value)}
                            />
                        )}

                        <div style={styles.headerActions}>
                            {isMobile ? (
                                <button style={styles.iconButton} onClick={() => setShowMobileMenu(true)}>
                                    <Icons.Menu />
                                </button>
                            ) : (
                                <>
                                    <button style={styles.iconButton} onClick={() => fileInputRef.current.click()} title="Open Project">
                                        <Icons.FolderOpen />
                                    </button>
                                    <button style={styles.iconButton} onClick={handleSaveProject} title="Save Project">
                                        <Icons.Save />
                                    </button>
                                    <button style={styles.iconButton} onClick={handleExportPNG} title="Export PNG">
                                        <Icons.Image />
                                    </button>
                                    <button style={{ ...styles.iconButton, background: 'var(--accent-amber)', color: 'var(--bg-primary)' }} onClick={handleExportDiagram} title="Export One-Page Diagram">
                                        <Icons.Download />
                                    </button>
                                </>
                            )}
                        </div>

                        <input
                            ref={fileInputRef}
                            type="file"
                            accept=".wirepro,.json"
                            onChange={handleLoadProject}
                            style={{ display: 'none' }}
                        />
                        <input
                            ref={importPartsRef}
                            type="file"
                            accept=".json"
                            onChange={handleImportParts}
                            style={{ display: 'none' }}
                        />
                    </header>

                    <div style={styles.mainContent}>
                        {/* Sidebar - Desktop only */}
                        {!isMobile && (
                            <aside style={styles.sidebar}>
                                <div style={styles.sidebarHeader}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                        <span style={styles.sidebarTitle}>Parts Library</span>
                                        <div style={{ display: 'flex', gap: '4px' }}>
                                            <button
                                                style={{ ...styles.iconButton, width: '28px', height: '28px' }}
                                                onClick={() => importPartsRef.current.click()}
                                                title="Import Parts"
                                            >
                                                <Icons.Upload />
                                            </button>
                                            <button
                                                style={{ ...styles.iconButton, width: '28px', height: '28px' }}
                                                onClick={handleExportParts}
                                                title="Export Custom Parts"
                                            >
                                                <Icons.Download />
                                            </button>
                                            <button
                                                style={{ ...styles.iconButton, width: '28px', height: '28px' }}
                                                onClick={() => setEditingPart({})}
                                                title="Create Part"
                                            >
                                                <Icons.Plus />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div style={styles.sidebarContent}>
                                    {Object.entries(groupedParts).map(([category, categoryParts]) => (
                                        <div key={category}>
                                            <div style={styles.categoryHeader}>{category}</div>
                                            {categoryParts.map(part => (
                                                <PartLibraryItem
                                                    key={part.id}
                                                    part={part}
                                                    onDragStart={handleDragStart}
                                                    onEdit={!DEFAULT_PARTS.find(d => d.id === part.id) ? setEditingPart : null}
                                                />
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </aside>
                        )}

                        {/* Canvas */}
                        <div
                            ref={canvasRef}
                            style={styles.canvas}
                            onDrop={handleDrop}
                            onDragOver={e => e.preventDefault()}
                            onClick={handleCanvasClick}
                        >
                            <div className="grid-pattern" style={styles.gridPattern} />
                            
                            <div style={{
                                ...styles.canvasInner,
                                transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`,
                            }}>
                                {/* Wires SVG Layer */}
                                <svg
                                    style={{
                                        position: 'absolute',
                                        top: 0,
                                        left: 0,
                                        width: '4000px',
                                        height: '4000px',
                                        pointerEvents: 'none',
                                        overflow: 'visible',
                                    }}
                                >
                                    <g style={{ pointerEvents: 'auto' }}>
                                        {wires.map(wire => (
                                            <Wire
                                                key={wire.id}
                                                wire={wire}
                                                components={components}
                                                selected={selectedWire === wire.id}
                                                onSelect={(id) => {
                                                    setSelectedWire(id);
                                                    setSelectedComponent(null);
                                                    setEditingWire(wires.find(w => w.id === id));
                                                }}
                                            />
                                        ))}
                                    </g>
                                </svg>

                                {/* Components */}
                                {components.map(comp => (
                                    <CanvasComponent
                                        key={comp.id}
                                        component={comp}
                                        selected={selectedComponent === comp.id}
                                        onSelect={setSelectedComponent}
                                        onDrag={handleComponentDrag}
                                        onPinClick={handlePinClick}
                                        scale={scale}
                                    />
                                ))}
                            </div>

                            {/* Wire Start Indicator */}
                            {wireStart && (
                                <div style={{
                                    position: 'absolute',
                                    top: '20px',
                                    left: '50%',
                                    transform: 'translateX(-50%)',
                                    padding: '8px 16px',
                                    background: 'var(--accent-amber)',
                                    color: 'var(--bg-primary)',
                                    borderRadius: '6px',
                                    fontSize: '13px',
                                    fontWeight: '600',
                                    animation: 'pulse 1.5s infinite',
                                    zIndex: 60,
                                }}>
                                    Select destination pin...
                                </div>
                            )}

                            {/* Toolbar */}
                            <div style={styles.toolbar}>
                                <button
                                    style={styles.iconButton}
                                    onClick={() => setScale(s => Math.min(s + 0.1, 2))}
                                >
                                    <Icons.ZoomIn />
                                </button>
                                <button
                                    style={styles.iconButton}
                                    onClick={() => setScale(s => Math.max(s - 0.1, 0.5))}
                                >
                                    <Icons.ZoomOut />
                                </button>
                                <button
                                    style={styles.iconButton}
                                    onClick={() => { setScale(1); setOffset({ x: 0, y: 0 }); }}
                                >
                                    <Icons.Move />
                                </button>
                                {selectedComponent && (
                                    <>
                                        <button
                                            style={styles.iconButton}
                                            onClick={() => {
                                                const comp = components.find(c => c.id === selectedComponent);
                                                if (comp) {
                                                    const copy = {
                                                        ...comp,
                                                        id: generateId(),
                                                        x: comp.x + 40,
                                                        y: comp.y + 40,
                                                        pins: comp.pins.map(p => ({ ...p, id: generateId() })),
                                                    };
                                                    setComponents([...components, copy]);
                                                    setSelectedComponent(copy.id);
                                                }
                                            }}
                                        >
                                            <Icons.Copy />
                                        </button>
                                        <button
                                            style={{ ...styles.iconButton, color: 'var(--accent-red)' }}
                                            onClick={handleDeleteComponent}
                                        >
                                            <Icons.Trash />
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Mobile Menu */}
                    {showMobileMenu && (
                        <div style={styles.mobileMenu}>
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '12px 16px', borderBottom: '1px solid var(--border-subtle)' }}>
                                <span style={{ fontSize: '16px', fontWeight: '600' }}>Menu</span>
                                <button style={styles.iconButton} onClick={() => setShowMobileMenu(false)}>
                                    <Icons.X />
                                </button>
                            </div>
                            
                            <div style={{ padding: '12px 16px' }}>
                                <label style={styles.label}>Project Name</label>
                                <input
                                    style={styles.input}
                                    value={projectName}
                                    onChange={e => setProjectName(e.target.value)}
                                />
                            </div>
                            
                            <div style={styles.tabBar}>
                                <button
                                    style={{ ...styles.tab, ...(mobileTab === 'parts' ? styles.tabActive : {}) }}
                                    onClick={() => setMobileTab('parts')}
                                >
                                    Parts
                                </button>
                                <button
                                    style={{ ...styles.tab, ...(mobileTab === 'actions' ? styles.tabActive : {}) }}
                                    onClick={() => setMobileTab('actions')}
                                >
                                    Actions
                                </button>
                            </div>

                            <div style={{ padding: '12px' }}>
                                {mobileTab === 'parts' && (
                                    <>
                                        <button
                                            style={{ ...styles.button, width: '100%', marginBottom: '12px' }}
                                            onClick={() => { setShowMobileMenu(false); setEditingPart({}); }}
                                        >
                                            <Icons.Plus /> Create New Part
                                        </button>
                                        {Object.entries(groupedParts).map(([category, categoryParts]) => (
                                            <div key={category}>
                                                <div style={styles.categoryHeader}>{category}</div>
                                                {categoryParts.map(part => (
                                                    <div
                                                        key={part.id}
                                                        style={styles.partItem}
                                                        onClick={() => handleAddMobilePart(part)}
                                                    >
                                                        <div style={styles.partItemName}>{part.name}</div>
                                                        <div style={styles.partItemCategory}>{part.pins.length} pins • Tap to add</div>
                                                    </div>
                                                ))}
                                            </div>
                                        ))}
                                    </>
                                )}
                                
                                {mobileTab === 'actions' && (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                        <button style={{ ...styles.button, ...styles.buttonSecondary }} onClick={() => { fileInputRef.current.click(); setShowMobileMenu(false); }}>
                                            <Icons.FolderOpen /> Open Project
                                        </button>
                                        <button style={{ ...styles.button, ...styles.buttonSecondary }} onClick={() => { handleSaveProject(); setShowMobileMenu(false); }}>
                                            <Icons.Save /> Save Project
                                        </button>
                                        <button style={{ ...styles.button, ...styles.buttonSecondary }} onClick={() => { handleExportPNG(); setShowMobileMenu(false); }}>
                                            <Icons.Image /> Export PNG
                                        </button>
                                        <button style={{ ...styles.button, background: 'var(--accent-amber)', color: 'var(--bg-primary)' }} onClick={() => { handleExportDiagram(); setShowMobileMenu(false); }}>
                                            <Icons.Download /> Export One-Page Diagram
                                        </button>
                                        <button style={{ ...styles.button, ...styles.buttonSecondary }} onClick={() => { importPartsRef.current.click(); setShowMobileMenu(false); }}>
                                            <Icons.Upload /> Import Parts
                                        </button>
                                        <button style={{ ...styles.button, ...styles.buttonSecondary }} onClick={() => { handleExportParts(); setShowMobileMenu(false); }}>
                                            <Icons.Download /> Export Custom Parts
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Part Editor Modal */}
                    {editingPart !== null && (
                        <PartEditorModal
                            part={editingPart.id ? editingPart : null}
                            onSave={handleSavePart}
                            onClose={() => setEditingPart(null)}
                        />
                    )}

                    {/* Wire Editor Modal */}
                    {editingWire && (
                        <WireEditorModal
                            wire={editingWire}
                            onSave={handleSaveWire}
                            onDelete={handleDeleteWire}
                            onClose={() => setEditingWire(null)}
                        />
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
